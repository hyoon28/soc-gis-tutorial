<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Emplacing Demographic Data | Spatial Data and Mapping for Sociologists</title>
  <meta name="description" content="This is a website with tutorials for Advanced Quantitative Methods in Contemporary Sociology’s Spatial Data and Mapping module." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Emplacing Demographic Data | Spatial Data and Mapping for Sociologists" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a website with tutorials for Advanced Quantitative Methods in Contemporary Sociology’s Spatial Data and Mapping module." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Emplacing Demographic Data | Spatial Data and Mapping for Sociologists" />
  
  <meta name="twitter:description" content="This is a website with tutorials for Advanced Quantitative Methods in Contemporary Sociology’s Spatial Data and Mapping module." />
  

<meta name="author" content="Hesu Yoon" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="from-people-to-built-environment.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SHORT TITLE HERE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#table-of-contents"><i class="fa fa-check"></i><b>1.1</b> Table of Contents</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="emplacing-demographic-data.html"><a href="emplacing-demographic-data.html"><i class="fa fa-check"></i><b>2</b> Emplacing Demographic Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="emplacing-demographic-data.html"><a href="emplacing-demographic-data.html#defining-a-geographic-unit-boundaries"><i class="fa fa-check"></i><b>2.1</b> Defining a geographic unit (boundaries)</a></li>
<li class="chapter" data-level="2.2" data-path="emplacing-demographic-data.html"><a href="emplacing-demographic-data.html#joining-attributes"><i class="fa fa-check"></i><b>2.2</b> Joining Attributes</a></li>
<li class="chapter" data-level="2.3" data-path="emplacing-demographic-data.html"><a href="emplacing-demographic-data.html#data-visualization"><i class="fa fa-check"></i><b>2.3</b> Data Visualization</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="emplacing-demographic-data.html"><a href="emplacing-demographic-data.html#choroleth-map"><i class="fa fa-check"></i><b>2.3.1</b> Choroleth map</a></li>
<li class="chapter" data-level="2.3.2" data-path="emplacing-demographic-data.html"><a href="emplacing-demographic-data.html#typology-map"><i class="fa fa-check"></i><b>2.3.2</b> Typology map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="from-people-to-built-environment.html"><a href="from-people-to-built-environment.html"><i class="fa fa-check"></i><b>3</b> From People to Built Environment</a>
<ul>
<li class="chapter" data-level="3.1" data-path="from-people-to-built-environment.html"><a href="from-people-to-built-environment.html#geocoding"><i class="fa fa-check"></i><b>3.1</b> Geocoding</a></li>
<li class="chapter" data-level="3.2" data-path="from-people-to-built-environment.html"><a href="from-people-to-built-environment.html#spatial-join"><i class="fa fa-check"></i><b>3.2</b> Spatial join</a></li>
<li class="chapter" data-level="3.3" data-path="from-people-to-built-environment.html"><a href="from-people-to-built-environment.html#mapping-businesses"><i class="fa fa-check"></i><b>3.3</b> Mapping businesses</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="explore-further-other-types-of-spatial-data.html"><a href="explore-further-other-types-of-spatial-data.html"><i class="fa fa-check"></i><b>4</b> Explore further: Other types of spatial data</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Data and Mapping for Sociologists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="emplacing-demographic-data" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Emplacing Demographic Data<a href="emplacing-demographic-data.html#emplacing-demographic-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter, we will discuss demographic data nested in places, which is often used in sociological research. Sociologists often study where people live and move to. Topics like migration, segregation, gentrification, integration/assimilation, and diversity/fractionalization can be studied using aggregated demographic data for a given geographic unit. To conduct such analysis, defining a geographic unit and boundary suitable for your research question is critical.</p>
<div id="defining-a-geographic-unit-boundaries" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Defining a geographic unit (boundaries)<a href="emplacing-demographic-data.html#defining-a-geographic-unit-boundaries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Geographic units can be defined and drawn at various levels, from nations to cities to neighborhoods. Territories are contested and (re)defined through social processes, therefore, it is important to clearly define and justify your choice of spatial boundary as a unit of analysis. Urban sociologists, for instance, tend to focus on studying neighborhood dynamics. But what are neighborhoods? While government-defined census tracts are often used as a proxy for neighborhoods in quantitative social science research, some scholars choose to analyze other types of boundaries, such as “community areas” that are more meaningful to its residents.</p>
<p><strong>THE CASE OF SAN FRANCISCO</strong></p>
<p>Let’s demonstrate the importance of defining a geographic unit using the case of San Francisco. San Francisco’s neighborhood names and boundaries have changed over time [1] and the current names and boundaries are often inconsistently perceived and administered [2].</p>
<div class="figure">
<img src="images/sf-name-change.png" alt="" />
<p class="caption">Source: SFGATE</p>
</div>
<p>In this tutorial, I visualize San Francisco neighborhoods based on census tracts as well as the “Analysis Neighborhood” created by the city officials. Many US city governments provide their local data through Open Data websites, including San Francisco’s <a href="https://datasf.org/opendata/">DataSF</a>. You want to look for “Geographic Locations &amp; Boundaries” tab.</p>
<div class="figure">
<img src="images/sf-open-data.png" alt="" />
<p class="caption">DataSF is an open data website provided by the city government of San Francisco</p>
</div>
<p>Here, you will find the 2010 census tract and “Analysis Neighborhood” boundaries, among many other geographic data.</p>
<ul>
<li>Geographic boundaries data can come in various formats, like geojson, shapefiles, etc.</li>
<li>In this tutorial, we use geojson files. You can download all the data used in this class here.</li>
<li>Geographic boundaries are “polygons”</li>
<li>We use <strong>sf package</strong> in R to handle spatial data.</li>
</ul>
<p>Set up and import geojson files.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="emplacing-demographic-data.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, you will have to set up by installing and calling the sf package.</span></span>
<span id="cb1-2"><a href="emplacing-demographic-data.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>) <span class="co">#install the package if you haven&#39;t.</span></span>
<span id="cb1-3"><a href="emplacing-demographic-data.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="emplacing-demographic-data.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import neighborhood boundaries data (polygons)</span></span>
<span id="cb2-2"><a href="emplacing-demographic-data.html#cb2-2" aria-hidden="true" tabindex="-1"></a>sfnh <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;tutorial/data/sfnh.geojson&quot;</span>) <span class="co"># for &quot;Analysis Neighborhood&quot; boundaries</span></span>
<span id="cb2-3"><a href="emplacing-demographic-data.html#cb2-3" aria-hidden="true" tabindex="-1"></a>sftrt <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;tutorial/data/sftrt_clean.geojson&quot;</span>) <span class="co"># for census tracts</span></span></code></pre></div>
<p>You can treat these sf objects as if they are data frames.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="emplacing-demographic-data.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overview of variables</span></span>
<span id="cb3-2"><a href="emplacing-demographic-data.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sfnh, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Simple feature collection with 3 features and 1 field
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -122.4761 ymin: 37.70833 xmax: -122.3983 ymax: 37.79037
## Geodetic CRS:  WGS 84
##                nhood                       geometry
## 1   Western Addition MULTIPOLYGON (((-122.4214 3...
## 2 West of Twin Peaks MULTIPOLYGON (((-122.461 37...
## 3  Visitacion Valley MULTIPOLYGON (((-122.4039 3...</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="emplacing-demographic-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform an sf object into a simple one data frame (without geometries)</span></span>
<span id="cb5-2"><a href="emplacing-demographic-data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>sfnh_wo_geo <span class="ot">&lt;-</span> <span class="fu">st_drop_geometry</span>(sfnh)</span>
<span id="cb5-3"><a href="emplacing-demographic-data.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="emplacing-demographic-data.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sfnh_wo_geo, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##                nhood
## 1   Western Addition
## 2 West of Twin Peaks
## 3  Visitacion Valley</code></pre>
<p>We can compare how these boundaries differ by mapping them next to each other. In this tutorial, we will use ggplot for mapping.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="emplacing-demographic-data.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-2"><a href="emplacing-demographic-data.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="emplacing-demographic-data.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying geometry only</span></span>
<span id="cb7-4"><a href="emplacing-demographic-data.html#cb7-4" aria-hidden="true" tabindex="-1"></a>sfnh_geo <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb7-5"><a href="emplacing-demographic-data.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sfnh, <span class="co"># add a layer to the plot using spatial data</span></span>
<span id="cb7-6"><a href="emplacing-demographic-data.html#cb7-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="co"># set the fill color of the spatial features</span></span>
<span id="cb7-7"><a href="emplacing-demographic-data.html#cb7-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="co"># set the color of boundaries</span></span>
<span id="cb7-8"><a href="emplacing-demographic-data.html#cb7-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  <span class="co"># set the thickness of the boundary lines</span></span>
<span id="cb7-9"><a href="emplacing-demographic-data.html#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()  <span class="co"># apply no background</span></span>
<span id="cb7-10"><a href="emplacing-demographic-data.html#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="emplacing-demographic-data.html#cb7-11" aria-hidden="true" tabindex="-1"></a>sftrt_geo <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-12"><a href="emplacing-demographic-data.html#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sftrt, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb7-13"><a href="emplacing-demographic-data.html#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()  </span>
<span id="cb7-14"><a href="emplacing-demographic-data.html#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="emplacing-demographic-data.html#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># combining maps</span></span>
<span id="cb7-16"><a href="emplacing-demographic-data.html#cb7-16" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(sfnh_geo, sftrt_geo, <span class="at">ncol=</span><span class="dv">2</span>,</span>
<span id="cb7-17"><a href="emplacing-demographic-data.html#cb7-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Analysis Neighborhood&quot;</span>,</span>
<span id="cb7-18"><a href="emplacing-demographic-data.html#cb7-18" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;2010 Census Tract&quot;</span>)</span>
<span id="cb7-19"><a href="emplacing-demographic-data.html#cb7-19" aria-hidden="true" tabindex="-1"></a>                  ) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>In my research, for example, I ask: How do Airbnb hosts use neighborhood names to market their properties? To answer this question, using census tract boundaries doesn’t really make sense because they don’t carry meanings. Rather, it would be more suitable to use boundaries such as Analysis Neighborhood.</p>
<p><strong>THINK AND SHARE</strong></p>
<ul>
<li>Are you interested in conducting spatial analysis on nations, cities, regions, or neighborhoods?</li>
<li>What spatial questions do you have about them?</li>
<li>How will you define their boundaries?</li>
</ul>
<p><em>Want to learn more?</em></p>
<ol style="list-style-type: decimal">
<li><a href="https://www.sfgate.com/places/article/What-did-your-neighborhood-used-to-be-called-15098783.php">San Francisco neighborhood name changes over time</a></li>
<li><a href="https://www.sfchronicle.com/projects/2022/san-francisco-neighborhoods/">San Francisco neighborhood boundaries are inconsistent</a></li>
<li><a href="https://www.nytimes.com/interactive/2023/upshot/extremely-detailed-nyc-neighborhood-map.html">New York residents’ perceptions of neighborhoods</a></li>
</ol>

</div>
<div id="joining-attributes" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Joining Attributes<a href="emplacing-demographic-data.html#joining-attributes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Geographic boundaries alone don’t tell us much about what is social about them. Sociologists, and social scientists more broadly, often are interested in <strong>people</strong> in these places. Therefore, matching aggregated demographic data with the geographic boundaries is a crucial next step.</p>
<p>We can merge a sf object with a data frame containing demographic attributes using the merge() function. Be careful with the order of the arguments, the returned object will be of the same type as x. It is not possible to do an attribute join using two sf objects.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="emplacing-demographic-data.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import demographic attributes</span></span>
<span id="cb8-2"><a href="emplacing-demographic-data.html#cb8-2" aria-hidden="true" tabindex="-1"></a>sfdem <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;tutorial/data/sfdem.csv&quot;</span>)</span>
<span id="cb8-3"><a href="emplacing-demographic-data.html#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="emplacing-demographic-data.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check common identifier</span></span>
<span id="cb8-5"><a href="emplacing-demographic-data.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sfdem)</span></code></pre></div>
<pre><code>##  [1] &quot;nhood&quot;    &quot;tpop&quot;     &quot;pyoung&quot;   &quot;pcol&quot;     &quot;minc&quot;     &quot;mhval&quot;   
##  [7] &quot;mrent&quot;    &quot;pwhite&quot;   &quot;pblack&quot;   &quot;pasian&quot;   &quot;phisp&quot;    &quot;tpop17&quot;  
## [13] &quot;pyoung17&quot; &quot;pcol17&quot;   &quot;minc17&quot;   &quot;mhval17&quot;  &quot;mrent17&quot;  &quot;gentcat&quot; 
## [19] &quot;pwhite17&quot; &quot;pblack17&quot; &quot;pasian17&quot; &quot;phisp17&quot;</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="emplacing-demographic-data.html#cb10-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Yes, in both data sets, &quot;nhood&quot; exists.</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="emplacing-demographic-data.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join attributes to geometry</span></span>
<span id="cb11-2"><a href="emplacing-demographic-data.html#cb11-2" aria-hidden="true" tabindex="-1"></a>sf_joined <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb11-3"><a href="emplacing-demographic-data.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> sfnh,            <span class="co"># sf object</span></span>
<span id="cb11-4"><a href="emplacing-demographic-data.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> sfdem,           <span class="co"># data frame</span></span>
<span id="cb11-5"><a href="emplacing-demographic-data.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="st">&quot;nhood&quot;</span>,      <span class="co"># x identifier</span></span>
<span id="cb11-6"><a href="emplacing-demographic-data.html#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.y =</span> <span class="st">&quot;nhood&quot;</span>,      <span class="co"># y identifier</span></span>
<span id="cb11-7"><a href="emplacing-demographic-data.html#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span>         <span class="co"># keep all lines</span></span>
<span id="cb11-8"><a href="emplacing-demographic-data.html#cb11-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-9"><a href="emplacing-demographic-data.html#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="emplacing-demographic-data.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate geometries</span></span>
<span id="cb11-11"><a href="emplacing-demographic-data.html#cb11-11" aria-hidden="true" tabindex="-1"></a>sf_joined <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(sf_joined)</span></code></pre></div>
<p>Now, we are able to explore neighborhood-level characteristics.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="emplacing-demographic-data.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-2"><a href="emplacing-demographic-data.html#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="emplacing-demographic-data.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Display population of neighborhoods</span></span>
<span id="cb12-4"><a href="emplacing-demographic-data.html#cb12-4" aria-hidden="true" tabindex="-1"></a>sf_joined <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="emplacing-demographic-data.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(nhood, tpop)</span></code></pre></div>
<pre><code>## Simple feature collection with 41 features and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -122.5149 ymin: 37.70813 xmax: -122.357 ymax: 37.8333
## Geodetic CRS:  WGS 84
## First 10 features:
##                             nhood     tpop                       geometry
## 1           Bayview Hunters Point 34834.88 MULTIPOLYGON (((-122.3816 3...
## 2                  Bernal Heights 24952.09 MULTIPOLYGON (((-122.4036 3...
## 3             Castro/Upper Market 20037.68 MULTIPOLYGON (((-122.4263 3...
## 4                       Chinatown 14360.00 MULTIPOLYGON (((-122.4067 3...
## 5                       Excelsior 37063.83 MULTIPOLYGON (((-122.4246 3...
## 6  Financial District/South Beach  9929.22 MULTIPOLYGON (((-122.3875 3...
## 7                       Glen Park  8053.00 MULTIPOLYGON (((-122.4474 3...
## 8                Golden Gate Park   137.00 MULTIPOLYGON (((-122.4426 3...
## 9                  Haight Ashbury 17009.00 MULTIPOLYGON (((-122.4321 3...
## 10                   Hayes Valley 16915.00 MULTIPOLYGON (((-122.4207 3...</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="emplacing-demographic-data.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the neighborhood named &quot;Mission&quot;</span></span>
<span id="cb14-2"><a href="emplacing-demographic-data.html#cb14-2" aria-hidden="true" tabindex="-1"></a>sf_joined <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="emplacing-demographic-data.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nhood <span class="sc">==</span> <span class="st">&quot;Mission&quot;</span>)</span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 22 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -122.4269 ymin: 37.74783 xmax: -122.403 ymax: 37.77564
## Geodetic CRS:  WGS 84
##     nhood     tpop   pyoung     pcol     minc    mhval   mrent  pwhite   pblack
## 1 Mission 60202.03 39.93308 33.86769 76201.05 634583.3 1267.62 32.5255 2.973325
##     pasian    phisp tpop17 pyoung17   pcol17   minc17 mhval17  mrent17
## 1 11.01126 50.07308  58770 34.39923 57.20385 125000.2 1106315 1870.846
##       gentcat pwhite17 pblack17 pasian17  phisp17
## 1 gentrifying 41.09069 3.660031 14.46827 35.66786
##                         geometry
## 1 MULTIPOLYGON (((-122.411 37...</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="emplacing-demographic-data.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the population of &quot;Mission&quot;</span></span>
<span id="cb16-2"><a href="emplacing-demographic-data.html#cb16-2" aria-hidden="true" tabindex="-1"></a>sf_joined <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="emplacing-demographic-data.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nhood <span class="sc">==</span> <span class="st">&quot;Mission&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="emplacing-demographic-data.html#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tpop)</span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 1 field
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -122.4269 ymin: 37.74783 xmax: -122.403 ymax: 37.77564
## Geodetic CRS:  WGS 84
##       tpop                       geometry
## 1 60202.03 MULTIPOLYGON (((-122.411 37...</code></pre>
<p><strong>THINK AND SHARE</strong></p>
<p>Below, you see two maps, each representing Chicago ans Seattle.
<img src="images/figure1.png" alt="Gentrification Stage Scores in Chicago and Seattle. Source: Hwang, Jackelyn. 2015.doi: 10.1177/0002716215579823" /></p>
<ul>
<li>What are the geographic boundaries used in this figure?</li>
<li>What attribute is displayed in the map?</li>
<li>Is this attribute quantitative or qualitative?</li>
</ul>

</div>
<div id="data-visualization" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Data Visualization<a href="emplacing-demographic-data.html#data-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>By merging demographic data with spatial boundaries, we can map demographic patterns. When it comes to mapping, it is important to consider what type of variable you intend to display.</p>
<ol style="list-style-type: decimal">
<li>Choropleth map</li>
<li>Typology map</li>
</ol>
<p>We can use or construct demographic variables of interest for mapping. Here, we will create two commonly used variables in urban research: diversity and gentrification.</p>
<div id="choroleth-map" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Choroleth map<a href="emplacing-demographic-data.html#choroleth-map" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In social science research, scholars often use the Herfindahl-Hirschman Index (HHI) as a measure for diversity. It is an economic index to measure the size of firms in relation to the industry they are in, but the formula is the same as the Simpson diversity index used in ecology, and can be applied to demographic contexts as well. The formula is:</p>
<p><span class="math display">\[
HHI = \sum_{i=1}^{N} (MS_i)^2
\]</span>
Where <span class="math inline">\(MS_i\)</span> is the market share of firm <span class="math inline">\(i\)</span> in the market, and <span class="math inline">\(N\)</span> is the number of firms.</p>
<p>In demographic research, sociologists use the HHI to measure racial diversity of neighborhoods. Instead of market share of firms in a market, we use the shares of racial groups in a neighborhood.</p>
<p>For example, in a neighborhood with 4 racial groups each representing 25%, the HHI would be:</p>
<p><span class="math display">\[
0.25^2 + 0.25^2 + 0.25^2 + 0.25^2 = 0.25
\]</span></p>
<p>or, more generally:</p>
<p><span class="math display">\[
HHI = \sum_{i=1}^{4} (0.25)^2 = 0.25
\]</span></p>
<p>The HHI of 25% means that there is a moderate level of diversity. However, as the HHI goes up, it means the market is more monopolized with less competition, or the neighborhood is predominantly represented by one group.</p>
<p>We can create this diversity measure using the variables we have.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="emplacing-demographic-data.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the HHI </span></span>
<span id="cb18-2"><a href="emplacing-demographic-data.html#cb18-2" aria-hidden="true" tabindex="-1"></a>sf_joined <span class="ot">&lt;-</span> sf_joined <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="emplacing-demographic-data.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diversity =</span> (pwhite<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> pblack<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> phisp<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> pasian<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb18-4"><a href="emplacing-demographic-data.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="emplacing-demographic-data.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check</span></span>
<span id="cb18-6"><a href="emplacing-demographic-data.html#cb18-6" aria-hidden="true" tabindex="-1"></a>sf_joined <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="emplacing-demographic-data.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(diversity)</span></code></pre></div>
<pre><code>## Simple feature collection with 41 features and 1 field
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -122.5149 ymin: 37.70813 xmax: -122.357 ymax: 37.8333
## Geodetic CRS:  WGS 84
## First 10 features:
##    diversity                       geometry
## 1   30.41952 MULTIPOLYGON (((-122.3816 3...
## 2   29.24377 MULTIPOLYGON (((-122.4036 3...
## 3   60.80993 MULTIPOLYGON (((-122.4263 3...
## 4   72.94796 MULTIPOLYGON (((-122.4067 3...
## 5   33.48204 MULTIPOLYGON (((-122.4246 3...
## 6   42.47888 MULTIPOLYGON (((-122.3875 3...
## 7   41.08415 MULTIPOLYGON (((-122.4474 3...
## 8   48.51617 MULTIPOLYGON (((-122.4426 3...
## 9   57.51691 MULTIPOLYGON (((-122.4321 3...
## 10  39.00489 MULTIPOLYGON (((-122.4207 3...</code></pre>
<p>Next, we can create a map displaying how diverse/homogeneous San Francisco neighborhoods are. For relative quantitative variables like the HHI, choroleth maps are useful.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="emplacing-demographic-data.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sf_joined) <span class="sc">+</span> <span class="co"># specify the source of spatial data</span></span>
<span id="cb20-2"><a href="emplacing-demographic-data.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> diversity), </span>
<span id="cb20-3"><a href="emplacing-demographic-data.html#cb20-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.2</span>,</span>
<span id="cb20-4"><a href="emplacing-demographic-data.html#cb20-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> <span class="co"># add a layer to use &quot;diversity&quot; to fill colors</span></span>
<span id="cb20-5"><a href="emplacing-demographic-data.html#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">type=</span><span class="st">&quot;seq&quot;</span>, <span class="co"># fill in sequential colors </span></span>
<span id="cb20-6"><a href="emplacing-demographic-data.html#cb20-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>, </span>
<span id="cb20-7"><a href="emplacing-demographic-data.html#cb20-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">quantile</span>(sf_joined<span class="sc">$</span>diversity), <span class="co"># set breaks at the quantile</span></span>
<span id="cb20-8"><a href="emplacing-demographic-data.html#cb20-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="co"># 1 for low (light) to high (dark), -1 for reverse</span></span>
<span id="cb20-9"><a href="emplacing-demographic-data.html#cb20-9" aria-hidden="true" tabindex="-1"></a>                       ) <span class="sc">+</span></span>
<span id="cb20-10"><a href="emplacing-demographic-data.html#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> nhood),  <span class="co"># add labels using the nhood variable</span></span>
<span id="cb20-11"><a href="emplacing-demographic-data.html#cb20-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="fl">1.5</span>, <span class="co"># size of the label text</span></span>
<span id="cb20-12"><a href="emplacing-demographic-data.html#cb20-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,         <span class="co"># color of the text</span></span>
<span id="cb20-13"><a href="emplacing-demographic-data.html#cb20-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>,          <span class="co"># background fill color</span></span>
<span id="cb20-14"><a href="emplacing-demographic-data.html#cb20-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;lines&quot;</span>),  <span class="co"># padding around the text</span></span>
<span id="cb20-15"><a href="emplacing-demographic-data.html#cb20-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.size =</span> <span class="dv">0</span>,        <span class="co"># thickness of the border around the label</span></span>
<span id="cb20-16"><a href="emplacing-demographic-data.html#cb20-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.5</span>,             <span class="co"># set transparency of the background</span></span>
<span id="cb20-17"><a href="emplacing-demographic-data.html#cb20-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="co"># suppress overlaping texts</span></span>
<span id="cb20-18"><a href="emplacing-demographic-data.html#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb20-19"><a href="emplacing-demographic-data.html#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;HHI&quot;</span>) <span class="co"># add a label for legend</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<ul>
<li>What are the least diverse neighborhoods? Which is the dominant racial group?</li>
<li>What are the most diverse neighborhoods?</li>
</ul>
</div>
<div id="typology-map" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Typology map<a href="emplacing-demographic-data.html#typology-map" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ve discussed maps suitable for quantitative variables so far. What about for qualitative variables? We use a typology map. We will create a gentrification measure to demonstrate a use case for typology map. Gentrification is a phenomenon that we measure over space and time. While there are multiple ways to define and measure gentrification, for the purposes of this tutorial, we will conceptualize gentrification as a neighborhood-level socioeconomic transformation comprised of both an influx of middle-and upper-class residents and an increase in housing prices in previously low-income, urban neighborhoods.</p>
<p>Our measure of gentrification is calculated at the census tract level from 2000 to 2020, so that we can examine how the socioeconomic composition of neighborhoods in San Francisco changes over time. The four variables listed below are used in our categorical measure of gentrification:</p>
<ul>
<li>Median household income (in 2020 Dollars)</li>
<li>Percent of college-educated residents</li>
<li>Median home value (in 2020 Dollars)</li>
<li>Median gross rent (in 2020 Dollars)</li>
</ul>
<p>The first step in computing the gentrification measure is determining whether or not a tract is <strong>eligible to gentrify (i.e., Gentrifiable).</strong> Generally, researchers consider tracts eligible to gentrify if they are relatively low-income neighborhoods such that they could undergo the revitalization that characterizes gentrification. We will operationalize eligibility to gentrify in a binary fashion using the median household income.</p>
<blockquote>
<p><strong>Not Gentrifiable</strong>: Census tracts had a median household income <em>above</em> the city-wide median household income at the start of the period.</p>
</blockquote>
<blockquote>
<p><strong>Gentrifiable</strong>: Census tracts had a median household income <em>below</em> the city-wide median household income at the start of the period.</p>
</blockquote>
<p>Next, among the census tracts that were Gentrifiable, we must determine if they were gentrifying over time or not. To classify the gentrifiable tracts as gentrifying or not gentrifying, we will need to calculate how much socioeconomic change and housing value change the tract experienced over the decade and compare the rate of change to the rate in the city.</p>
<blockquote>
<p><strong>Gentrifying</strong>: Gentrifiable census tracts that had the socioeconomic status of their residents (i.e., % college graduates OR median household income) grow faster than the city wide-median <em>AND</em> the home values (median home value OR median gross rent value) grow faster than the city-wide median over the decade period.</p>
</blockquote>
<blockquote>
<p><strong>Not Gentrifying</strong>: Gentrifiable census tracts that did NOT experience growth in the socioeconomic status of their residents <em>AND</em> their home values at a rate higher than the city-wide median values over the decade period.</p>
</blockquote>
<p>This measurement strategy results in a three-category gentrification measure - Not Gentrifiable, Gentrifying, and Not Gentrifying. With these three categories we can make a typology map of census tracts in San Francisco.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="emplacing-demographic-data.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In-class assignment</span></span>
<span id="cb21-2"><a href="emplacing-demographic-data.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Determine the boundaries: Should we use census tract or analysis neighborhood boundaries?</span></span>
<span id="cb21-3"><a href="emplacing-demographic-data.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Use census tracts.</span></span>
<span id="cb21-4"><a href="emplacing-demographic-data.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="emplacing-demographic-data.html#cb21-5" aria-hidden="true" tabindex="-1"></a>sftrt_dem <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;tutorial/data/sftrt_dem.csv&quot;</span>)</span>
<span id="cb21-6"><a href="emplacing-demographic-data.html#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="emplacing-demographic-data.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if it has a common identifier with sftrt</span></span>
<span id="cb21-8"><a href="emplacing-demographic-data.html#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sftrt_dem<span class="sc">$</span>trt10)</span></code></pre></div>
<pre><code>## [1] 10100 10200 10300 10400 10500 10600</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="emplacing-demographic-data.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sftrt_dem<span class="sc">$</span>trt10)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="emplacing-demographic-data.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sftrt<span class="sc">$</span>tractce10)</span></code></pre></div>
<pre><code>## [1] &quot;016400&quot; &quot;016100&quot; &quot;015900&quot; &quot;015500&quot; &quot;015300&quot; &quot;015100&quot;</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="emplacing-demographic-data.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sftrt<span class="sc">$</span>tractce10)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="emplacing-demographic-data.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill with leading zeros and convert to string</span></span>
<span id="cb29-2"><a href="emplacing-demographic-data.html#cb29-2" aria-hidden="true" tabindex="-1"></a>sftrt_dem <span class="ot">&lt;-</span> sftrt_dem <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="emplacing-demographic-data.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tractce10 =</span> <span class="fu">as.character</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%06d&quot;</span>, trt10)))</span>
<span id="cb29-4"><a href="emplacing-demographic-data.html#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="emplacing-demographic-data.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Join demographic data to geometric boundaries</span></span>
<span id="cb29-6"><a href="emplacing-demographic-data.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># use either &quot;sfdem.csv&quot; (analysis) or &quot;sftrt_dem.csv&quot; (census tract)</span></span>
<span id="cb29-7"><a href="emplacing-demographic-data.html#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="emplacing-demographic-data.html#cb29-8" aria-hidden="true" tabindex="-1"></a>sftrt_joined <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb29-9"><a href="emplacing-demographic-data.html#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> sftrt,            <span class="co"># sf object</span></span>
<span id="cb29-10"><a href="emplacing-demographic-data.html#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> sftrt_dem,           <span class="co"># data frame</span></span>
<span id="cb29-11"><a href="emplacing-demographic-data.html#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="st">&quot;tractce10&quot;</span>,      <span class="co"># x identifier</span></span>
<span id="cb29-12"><a href="emplacing-demographic-data.html#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.y =</span> <span class="st">&quot;tractce10&quot;</span>,      <span class="co"># y identifier</span></span>
<span id="cb29-13"><a href="emplacing-demographic-data.html#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span>,         <span class="co"># keep all lines</span></span>
<span id="cb29-14"><a href="emplacing-demographic-data.html#cb29-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="emplacing-demographic-data.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a typology map</span></span>
<span id="cb30-2"><a href="emplacing-demographic-data.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sftrt_joined) <span class="sc">+</span> </span>
<span id="cb30-3"><a href="emplacing-demographic-data.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gentcat), </span>
<span id="cb30-4"><a href="emplacing-demographic-data.html#cb30-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.02</span>,</span>
<span id="cb30-5"><a href="emplacing-demographic-data.html#cb30-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-6"><a href="emplacing-demographic-data.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;non-gentrifiable&quot;</span> <span class="ot">=</span> <span class="st">&quot;light grey&quot;</span>, </span>
<span id="cb30-7"><a href="emplacing-demographic-data.html#cb30-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;gentrifying&quot;</span> <span class="ot">=</span> <span class="st">&quot;pink&quot;</span>, </span>
<span id="cb30-8"><a href="emplacing-demographic-data.html#cb30-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;non-gentrifying&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb30-9"><a href="emplacing-demographic-data.html#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="co"># minimalist theme, but keeping the legend</span></span>
<span id="cb30-10"><a href="emplacing-demographic-data.html#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># customize the legend title and position</span></span>
<span id="cb30-11"><a href="emplacing-demographic-data.html#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Gentrification Category&quot;</span>, </span>
<span id="cb30-12"><a href="emplacing-demographic-data.html#cb30-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Gentrification in San Francisco&quot;</span>) <span class="sc">+</span> </span>
<span id="cb30-13"><a href="emplacing-demographic-data.html#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># customize legend position and map layout (optional)</span></span>
<span id="cb30-14"><a href="emplacing-demographic-data.html#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)  <span class="co"># You can also use &quot;bottom&quot; or &quot;left&quot;)</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p><em>Data sources</em></p>
<p>Aggregated demographic data and spatial boundaries are collected and disseminated by national and municipal government, as well as international organizations (e.g., United Nations).</p>
<p><a href="https://rcarto.github.io/geomatique_avec_r/2001_donnees.html" class="uri">https://rcarto.github.io/geomatique_avec_r/2001_donnees.html</a></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="from-people-to-built-environment.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/edit/main/02-dem-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/blob/main/02-dem-data.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
