# From People to Built Environment


So far, we have focused on embedding demographic data into places. However, sociologists' inquiries go beyond people. People don't just exist in places but they interact with the built environment. In this tutorial, we will use Airbnbs and local businesses

## Airbnbs

When the data contains the latitude and longitude, we can simply transform it to sf object by using "st_as_sf" command. We use the Airbnb data in San Francisco to illustrate this case. Unlike neighborhood boundaries of which geometries were polygons, these geometries will be **points**.

```{r}
# Import the Airbnb data
sfbnb <- read.csv("tutorial/data/sfbnb.csv")

# Transform lat/long data into sf object
sf_sfbnb <- st_as_sf(sfbnb, 
                     coords = c("longitude", "latitude"), 
                     crs = 4326 # specify the projection; WGS 84 is a standard projection for global mapping. 
                     )
```

## Explore
```{r}
# Check variables
head(sf_sfbnb, n=3)

# Display the points in the map
plot(sf_sfbnb)
```

## Restaurants

When the data contains street addresses, we have to perform **geocoding** which converts formatted addresses into latitude and longitude. Below, we use the restaurant data in San Francisco to demonstrate this.

```{r}
# Set up
library(tidygeocoder)

# Import restaurant data
sfbiz <- read.csv("tutorial/data/sfbiz_clean.csv") 

# Check if lat and lon exists
head(sfbiz, 3)
```

In this data, we can see that latitude and longitude does not exist. However, it contains street address, city, state, and zip code. We have to create a field that displays the full address. Using this full address, we can perform geocoding using open street map (osm). Once the data is geocoded, we can transform this data frame to sf object for mapping.

```{r}
# Create a full address field (street address, city, state, zipcode)
sfbiz <- sfbiz %>%
  mutate(full_add = paste(address_line_1, city, state, zipcode, sep = ", "))

# Geocode the full address
geocoded_sfbiz <- sfbiz %>%
  sample_n(20) %>% # the full data can take a while, so let's try on a smaller sample
  geocode(address = full_add, method = 'osm')
```

```{r}
# For the purpose of this tutorial, we can use the prepared geocoded data
prep_sfbiz <- read.csv("tutorial/data/geocoded_sfbiz_clean.csv") 

# Transform lat/long data into sf oject
sf_sfbiz <- st_as_sf(prep_sfbiz, 
                     coords = c("long", "lat"), 
                     crs = 4326)
```

## Explore
```{r}
# Check variables
head(sf_sfbiz, n=3)

# Display the points in the map
plot(sf_sfbiz)
```

## Export data 
```{r}
# export restaurants
st_write(sf_sfbiz, "restaurants.geojson", driver = "GeoJSON")

# export airbnbs
st_write(sf_sfbnb, "airbnbs.geojson", driver = "GeoJSON")
```


