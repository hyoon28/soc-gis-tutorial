# From People to Built Environment


So far, we have focused on embedding demographic data into places. However, sociological questions extend beyond just understanding people in places. People don’t simply exist in locations—they interact with the built environment, including schools, local businesses, landmarks, and more. In GIS terms, this type of data is known as point-of-interest (POI) data, which refers to specific points or useful sites identified by geographic coordinates (latitude and longitude). In this tutorial, we will use Airbnb listings and local business data as examples of point-of-interest data.

## Transforming Airbnbs

When data contains latitude and longitude coordinates, we can transform it into an sf object by using the st_as_sf command. Here, we’ll use San Francisco Airbnb data to illustrate this process. Unlike neighborhood boundaries, which have polygon geometries, POIs will have **point** geometries.

```{r import-bnb}
# Import the Airbnb data
sfbnb <- read.csv("data/sfbnb.csv")

head(sfbnb, 3)
```

```{r transform-bnb}
# Transform lat/long into sf object
sf_sfbnb <- st_as_sf(sfbnb, 
                     coords = c("longitude", "latitude"), 
                     crs = 4326 # specify the projection; WGS84 is a standard projection for global mapping. 
                     )
# Check the data
head(sf_sfbnb, 3)
```

You can see that geometry is points, rather than polygons. Each point represents an Airbnb property (id- unique identifier). It also indicates the census tract (trt10) and neighborhood name (analysis) in which the Airbnb  property is located. The data also contains attributes of the Airbnb property, such as property type, review score ratings, and the number of reviews.

You can save the converted file as geojson using the "st_write" command.

```{r export-bnb, results='hide', warning=FALSE, message=FALSE}
# Export the Airbnb data as a geojson file
st_write(sf_sfbnb, "processed-data/airbnbs.geojson", driver = "GeoJSON", delete_dsn = TRUE)
```


## Geocoding Restaurants

Sometimes, your data may lack latitude and longitude information. Instead, the data may contain street addresses. In such cases, we need to perform **geocoding** which converts formatted addresses into latitude and longitude coordinates, allowing the data to be displayed as points on a map. Below, we will demonstrate the geocoding process using the restaurant data in San Francisco.

```{r import-biz}
# Import restaurant data
sfbiz <- read.csv("data/sfbiz_clean.csv") 

# Check if lat and lon exists
head(sfbiz, 3)
```

In this data, we can see that latitude and longitude coordinates do not exist. However, it contains information on street address, city, state, and zip code. To carry out geocoding, first, we have to create a field that displays a full address. Based on the full address, we can get the coordinates via open street map (osm). Once the data is geocoded, we can transform this data frame to sf object for mapping.

```{r geocode, warning=FALSE, message=FALSE}
# Set up
library(tidygeocoder)

# Create a full address field (street address, city, state, zipcode)
sfbiz <- sfbiz %>%
  mutate(full_add = paste(address_line_1, city, state, zipcode, sep = ", "))

# Geocode the full address
geocoded_sfbiz <- sfbiz %>%
  sample_n(5) %>% # the full data can take a while, so let's try on a smaller sample
  geocode(address = full_add, method = 'osm')

# Check the geocoded data
geocoded_sfbiz %>%
  select(lat, long)
```

```{r import-geocoded}
# For the purpose of this tutorial, we can use the prepared, full geocoded data
prep_sfbiz <- read.csv("data/geocoded_sfbiz_clean.csv") 

# Transform lat/long data into sf oject
sf_sfbiz <- st_as_sf(prep_sfbiz, 
                     coords = c("long", "lat"), 
                     crs = 4326)

head(sf_sfbiz, 5)
```

```{r export-biz, results='hide', warning=FALSE, message=FALSE}
# Export the restaurant data as a geojson file
st_write(sf_sfbiz, "processed-data/restaurants.geojson", driver = "GeoJSON", delete_dsn = TRUE)
```


